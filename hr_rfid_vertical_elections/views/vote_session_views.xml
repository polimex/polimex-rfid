<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="vote_session_view_search" model="ir.ui.view">
        <field name="name">Vote session search view</field>
        <field name="model">voting.session</field>
        <field name="arch" type="xml">
            <search string="Voting Session">
                <field name="name" string="Session name"/>
                <field name="create_uid"/>
                <field name="item_ids"/>
                <field name="participant_group_id"/>
                <filter name="state" string="Draft" domain="[('state', '=', 'draft')]"/>
                <filter name="state" string="Open" domain="[('state', '=', 'open')]"/>
                <filter name="state" string="Closed" domain="[('state', '=', 'closed')]"/>
                <filter name="state" string="Revoted" domain="[('state', '=', 'revoted')]"/>
                <filter name="create_uid" string="My Sessions" domain="[('create_uid', '=', uid)]"/>
                <filter name="sessions_today" string="Today Sessions"
                        domain="[('planned_date', '=', context_today().strftime('%Y-%m-%d'))]"/>
                <filter name="group_by_create_uid" context="{'group_by': 'create_uid'}"/>
                <filter name="group_by_planned_date" context="{'group_by': 'planned_date'}"/>
                <filter name="group_by_state" context="{'group_by': 'state'}"/>
            </search>
        </field>
    </record>

    <record id="vote_session_view_calendar" model="ir.ui.view">
        <field name="name">vote.session..view.calendar</field>
        <field name="model">voting.session</field>
        <field name="arch" type="xml">
            <calendar date_start="start_datetime"
                      date_stop="end_datetime"
                      color="state"
                      quick_create="0"
                      create="0" delete="0"
                      event_open_popup="1"
            >
                <field name="item_ids"/>
            </calendar>
        </field>
    </record>

    <record id="vote_session_view_list" model="ir.ui.view">
        <field name="name">vote.session.view.list</field>
        <field name="model">voting.session</field>
        <field name="arch" type="xml">
            <list>
                <field name="name" string="Name"/>
                <field name="start_datetime"/>
                <field name="end_datetime"/>
                <field name="state"/>
            </list>
        </field>
    </record>

    <record id="vote_session_view_kanban" model="ir.ui.view">
        <field name="name">vote_session.view.kanban</field>
        <field name="model">voting.session</field>
        <field name="arch" type="xml">
            <kanban default_group_by="state"
                    records_draggable="false"
                    group_create="false"
                    quick_create="false">
                <!--                    default_order="state">-->
                <field name="state"/>
                <field name="final_vote"/>
                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_global_click">
                            <div class="o_kanban_record_top">
                                <strong class="o_kanban_record_title">
                                    <field name="display_name"/>
                                </strong>
                            </div>
                            <div class="oe_kanban_content">
                                <ul class="ps-1 mb-0 list-unstyled">
                                    <li>
                                        <strong>Planned for:</strong>
                                        <field name="planned_date"/>
                                    </li>
                                    <li>
                                        <strong>Display:</strong>
                                        <field name="display_id"/>
                                    </li>
                                    <t t-if="record.start_datetime.raw_value">
                                        <li>
                                            <!--                                            <strong>Start: </strong>-->
                                            <field name="start_datetime"/>
                                            <i class="fa fa-long-arrow-right mx-1" title="Until"/>
                                            <field name="end_datetime"/>
                                        </li>
                                    </t>
                                    <t t-if="record.state.raw_value == 'closed'">
                                        <li>
                                            <t t-if="record.final_vote.raw_value == 'yes'">
                                                <span style="font-weight:bold;" class="mt4 text-success">
                                                    <strong>Final Vote:</strong>
                                                </span>
                                                <span style="font-weight:bold;" class="fa mt4 fa-smile-o text-success">
                                                    <field name="final_vote"/>
                                                </span>
                                            </t>
                                            <t t-if="record.final_vote.raw_value == 'no'">
                                                <span style="font-weight:bold;" class="mt4 text-danger">
                                                    <strong>Final Vote:</strong>
                                                </span>
                                                <span style="font-weight:bold;" class="fa mt4 fa-frown-o text-danger">
                                                    <field name="final_vote"/>
                                                </span>
                                            </t>
                                            <t t-if="record.final_vote.raw_value == 'no_vote'">
                                                <span style="font-weight:bold;" class="mt4 text-warning">
                                                    <strong>Final Vote:</strong>
                                                </span>
                                                <span style="font-weight:bold;" class=" mt4 text-warning">
                                                    <field name="final_vote"/>
                                                </span>
                                            </t>
                                        </li>
                                    </t>

                                    <li>
                                        <field name="description"/>
                                    </li>
                                </ul>
                            </div>
                            <div class="o_kanban_record_bottom">
                                <div class="oe_kanban_bottom_left">
                                    <t t-if="record.state.raw_value =='closed' or record.state.raw_value == 'revoted'">
                                        <span style="font-weight:bold;" class="fa mt4 fa-hand-o-up text-information">
                                            Yes:
                                            <field name="vote_yes" class="oe_inline"/>
                                            /
                                            No:
                                            <field name="vote_no" class="oe_inline"/>
                                            /
                                            Abstain:
                                            <field name="vote_abstain" class="oe_inline"/>
                                        </span>
                                    </t>
                                </div>
                                <div class="oe_kanban_bottom_right">
                                    <field name="create_uid" widget="many2one_avatar_user"/>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <record id="vote_session_view_form" model="ir.ui.view">
        <field name="name">vote.session.view.form</field>
        <field name="model">voting.session</field>
        <field name="arch" type="xml">
            <form>
                <header>
                    <button
                            name="button_open_voting_session"
                            type="object"
                            invisible="state!='draft'"
                            string="Open Voting"
                    />
                    <button
                            name="button_close_voting_session"
                            type="object"
                            invisible="state!='open'"
                            string="Close Voting"
                    />
                    <button
                            name="button_re_voting_session"
                            type="object"
                            invisible="state!='closed'"
                            string="Re Voting"
                    />
<!--                    <button name="action_vote_result_send" id="send_by_email" string="Send Result by Email" type="object"-->
<!--                            invisible="state not in ('draft', 'sale')" data-hotkey="g"-->
<!--                    />-->

                    <field name="state" widget="statusbar"/>
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button name="open_votes_action"
                                type="object"
                                class="oe_stat_button"
                                icon="fa-history">
                            <field name="vote_total" widget="statinfo" string="Votes"/>
                        </button>
                    </div>
                    <widget
                            name="web_ribbon"
                            title="Vote Finished"
                            bg_color="bg-success"
                            invisible="state != 'closed'"
                    />
                    <widget
                            name="web_ribbon"
                            title="Vote in Progress"
                            bg_color="bg-warning"
                            invisible="state != 'open'"
                    />
                    <group invisible="state != 'closed' or final_vote != 'yes'">
                        <p
                                class="alert alert-success"
                                role="alert"
                                colspan="2"
                        >The final vote for this voting is <strong>YES</strong>. The item is accepted.
                        </p>
                    </group>
                    <group invisible="state != 'closed' or final_vote != 'no'">
                        <p
                                class="alert alert-danger"
                                role="alert"
                                colspan="2"
                        >The final vote for this voting is <strong>NO</strong>. The item is rejected.
                        </p>
                    </group>
                    <div class="oe_title mb-3">
                        <label for="name"/>
                        <h1>
                            <field name="name" placeholder="E.g. Vote for new rules"/>
                        </h1>
                    </div>
                    <group>
                        <group>
                            <field name="description"/>
                            <field name="voting_time" readonly="state!='draft'"/>
                            <field name="vote_results_time" readonly="state!='draft'"/>

                        </group>
                        <group>
                            <field name="planned_date" readonly="state!='draft'"/>
                            <field name="start_datetime" readonly="1"/>
                            <field name="end_datetime" readonly="1"/>
                            <!--                            <field name="end_datetime" string="Date" widget="daterange" options="{'end_date_field': 'end_datetime'}"/>-->
                        </group>
                        <group string="Settings">
                            <field name="item_ids" widget="many2many_tags"/>
                            <field name="participant_group_id"/>
                            <field name="display_id"/>
                        </group>
                        <group string="Organizer">
                            <field name="create_uid" widget="many2one_avatar_user" readonly="1"/>
                            <field name="state"/>
                            <field name="new_session_id" readonly="1" invisible="not new_session_id"/>
                            <field name="old_session_id" readonly="1" invisible="not old_session_id"/>
                        </group>
                    </group>
                    <group string="Results" invisible="state == 'draft'">
                        <field name="final_vote"/>
                    </group>
                    <!--                    <group string="Results" invisible="state != 'closed'">-->
                    <group string="Results details" invisible="state == 'draft'">
                        <group>
                            <field name="vote_yes"/>
                        </group>
                        <group>
                            <field name="vote_no"/>
                        </group>
                        <group>
                            <field name="vote_abstain"/>
                        </group>
                        <group>
                            <field name="vote_total"/>
                        </group>
                    </group>
                </sheet>
                 <chatter reload_on_follower="True"/>
            </form>
        </field>
    </record>

    <record id="vote_session_action" model="ir.actions.act_window">
        <field name="name">Vote Session</field>
        <field name="res_model">voting.session</field>
        <field name="view_mode">kanban,calendar,list,form</field>
    </record>
</odoo>
